name: CI - Python Tests

on:
  push:
    branches:
      - main
    # DÃ©clenchement sur changements pertinents uniquement
    paths:
      - '**/*.py'
      - 'requirements.txt'
      - '.github/workflows/**'
  pull_request:
    branches:
      - main
    paths:
      - '**/*.py'
      - 'requirements.txt'
      - '.github/workflows/**'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      # ğŸ’¡ Bonne pratique : Utiliser une version de Python supportÃ©e par l'environnement GitHub
      # Python 3.13.7 n'est pas encore disponible sur tous les runners. 
      # Je recommande 3.11 ou 3.12, ou 3.10 si vous voulez Ãªtre plus sÃ»r. 
      # Je laisse 3.13.7 si c'est vraiment votre version locale, mais soyez prÃªt Ã  la changer.
      - name: ğŸ Set up Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: "3.13.7"

      - name: âš™ï¸ Install dependencies
        run: |
          # Toujours mettre Ã  jour pip
          python -m pip install --upgrade pip
          
          # Installer toutes les dÃ©pendances (y compris les dÃ©pendances de test comme httpx)
          # Ã  partir du fichier requirements.txt allÃ©gÃ©.
          pip install -r requirements.txt
          
          # âŒ Suppression des lignes 'pip install pytest pytest-mock httpx' : 
          # Ces packages DOIVENT Ãªtre listÃ©s dans requirements.txt pour Ãªtre bien versionnÃ©s.
          # S'ils sont dÃ©jÃ  dans requirements.txt, cette double installation est inutile.

      - name: ğŸ§ª Run tests
        run: |
          pytest tests/